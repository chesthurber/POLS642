---
title: "W5: Binary Variables"
subtitle: "POLS 642 Intermediate Analysis of Political Data"
author: "Dr. Ches Thurber"
format: 
  revealjs:
    theme: simple
execute: 
  echo: true
editor: visual
---

## Plan for Today

1\) Transformations

2\) Binary IVs

3\) Interactions

4\) Categorical IVs

4\) Binary DVs

## Packages

```{r}
library(gapminder)
library(dplyr)
library(ggplot2)
gapminder <- gapminder
```

# Transformations

## Regression the Easy Way

```{r}
gap.model <- lm(lifeExp~gdpPercap, data = gapminder)
gap.model
```

-   Interpreting intercept: "When pcGDP is 0, our estimate for life expectancy is is 54"

-   Interpreting slope: "For every 1 unit (\$) increase in pcGDP, we predict a .00076 year increase in life expectancy"

-   If a country had a pcGDP of \$10,000, what would we expect the life expectancy to be?

## The Full Output

```{r}
summary(gap.model)
```

## Oops

```{r, echo = F, warning = F}
ggplot(gapminder, aes(x = gdpPercap, y = lifeExp))+
    geom_point() +
  geom_smooth(method = "lm", formula = y ~ x) +
  labs(x = "GDP Per Capita", y = "Life Expectancy in Years",
         title = "Economic Development and Life Expectancy",
         subtitle = "Data points are country-years",
         caption = "Source: Gapminder.") + 
  theme_bw()

```

## Let's make our line bend

-   how do we draw a graph of curve in algebra?

    ![](https://d20khd7ddkh5ls.cloudfront.net/graphs_expressions.png)

## Squared Term

```{r}
gap.model.sq <- lm(lifeExp~I(gdpPercap^2) + gdpPercap, data = gapminder)
summary(gap.model.sq)
```

## Visualizing the Polynomial

```{r, echo = F, warning = F}
ggplot(gapminder, aes(x = gdpPercap, y = lifeExp))+
    geom_point() +
  geom_smooth(method = "lm", formula = y ~ I(x^2)+x) +
  labs(x = "GDP Per Capita", y = "Life Expectancy in Years",
         title = "Economic Development and Life Expectancy",
         subtitle = "Data points are country-years",
         caption = "Source: Gapminder.") + 
  theme_bw()
```

## Notes About Polynomials

-   use when you have a theoretical reason to think there might be a U or upside-down U relationship

-   always include both the squared and the non-squared term

-   it's possible to have a cubed term...but rarely makes sense

-   do not try to interpret the coefficients individually...just graph it

## Logarithmic Transformations

-   Log_10: Transforms 10, 100, 1000 into 1, 2, 3

-   Ln = "natural log," it just has some nice mathematical properties

-   creates a diminishing returns relationship

-   can be interpreted as a 100% increase in X is associated with a $\hat\beta_1$ increase un Y

## Log Transformation in Action

```{r}
gap.model.log <- lm(lifeExp~log10(gdpPercap), data = gapminder)
summary(gap.model.log)
```

## Log Visualized

```{r, echo=FALSE}
ggplot(gapminder, aes(x = gdpPercap, y = lifeExp))+
    geom_point() +
  geom_smooth(method = "lm", formula = y ~ log10(x)) +
  labs(x = "GDP Per Capita", y = "Life Expectancy in Years",
         title = "Economic Development and Life Expectancy",
         subtitle = "Data points are country-years",
         caption = "Source: Gapminder.") + 
  theme_bw()
```

## Viewed Another Way

```{r}
ggplot(gapminder, aes(x = gdpPercap, y = lifeExp))+
    geom_point() +
  geom_smooth(method = "lm", formula = y ~ x) +
  scale_x_log10() + 
  labs(x = "GDP Per Capita", y = "Life Expectancy in Years",
         title = "Economic Development and Life Expectancy by Continent",
         subtitle = "Data points are country-years",
         caption = "Source: Gapminder.") + 
  theme_bw()
```

## When to use transformations

-   use a transformation when you think the relationship between X and Y *changes* based on the value of X

-   if you think it diminishes as X increases, use a **log transformation**

    -   e.g. "I think increased pcGDP will be associated with longer life expectancies up to a point, but once pcGDP is already high, increasing further will not have as much of an effect"

    -   not a bad idea to always use when the distribution of a variable is highly skewed

    -   if you have 0s in your data, you will need to use something else (e.g. square root)

## When to use transformations

-   if you think it changes from positive to negative as X increases, use a squared polynomial term

    -   e.g. "I think once you get to a certain point, greater pcGDP will actually be associated with lower life expectancies" (but this doesn't actually make sense!)

    -   e.g. "I think protest will be less likely in highly authoritarian countries (Polity \< -5), more likely in anocracies (Polity -5 to 5), but then less likely again in democratic countries (Polity \> 5)" (this makes more sense)

# Binary Independent Variables

## Let's Separate Oil Countries

```{r}
oil <- c("Kuwait", "Saudi Arabia", "Venezuela", "Norway", "Iran")
gapminder$oil <- factor(ifelse(gapminder$country %in% oil, 1, 0))
```

## Add to Our Model

```{r}
gap.model.oil <- lm(lifeExp~log10(gdpPercap)+ oil, data = gapminder)
summary(gap.model.oil)
```

## Visualized

```{r echo=F}
ggplot(gapminder, aes(x = gdpPercap, y = lifeExp, color = oil))+
    geom_point() +
  geom_abline(slope = 20, intercept = -11, color = "red") +
  geom_abline(slope = 20, intercept = -19, color = "blue") + 
  scale_x_log10() +
  labs(x = "GDP Per Capita", y = "Life Expectancy in Years",
         title = "Economic Development and Life Expectancy",
         subtitle = "Data points are country-years",
         caption = "Source: Gapminder.") + 
  theme_bw()
```

# Interactions

## Different Slopes

-   binary/categorical variables assign different intercepts, but the slopes remain the same

-   e.g. oil countries have lower life expectancies, but the same relationship between GDP and life expectancy

-   what if we thought the relationship between X and Y changed based on another factor Z?

-   e.g. that increases in GDP have a different effect on life expectancy in oil countries as compared to non-oil countries?

## Interaction Terms

-   we add a term to our model in which we multiply two variables together

-   original model: $\hat{Y} = \hat{\beta_0} + \hat{\beta_1}X_1 + \hat{\beta_2}X_2$

-   interaction model: $\hat Y = \hat\beta_0 + \hat\beta_1X_1 + \hat\beta_2X_2 + \hat\beta_3X_1*X_2$

*What is the slope of* $X_1$ *when* $X_2 = 0$*? When* $X_2 = 1$ *?*

## Dial it up

```{r}

gap.model.int <- lm(lifeExp~log10(gdpPercap)* oil, data = gapminder)
summary(gap.model.int)
```

## On a graph

```{r echo=F}

ggplot(gapminder, aes(x = gdpPercap, y = lifeExp, color = oil))+
    geom_point() +
  geom_abline(slope = 20, intercept = -12, color = "red") +
  geom_abline(slope = 11, intercept = 18, color = "blue") + 
  scale_x_log10() +
  labs(x = "GDP Per Capita", y = "Life Expectancy in Years",
         title = "Economic Development and Life Expectancy",
         subtitle = "Data points are country-years",
         caption = "Source: Gapminder.") + 
  theme_bw()
```

## When to use interactions

-   use an interaction when you think the relationship between X and Y *changes* based on the value of some other variable (Z)

    -   e.g. "I think that additional per capita GDP will have a bigger impact on life expectancy in non-oil countries than oil countries

-   just add a categorical/dummy control variable when you think some other variable impacts Y, but not the relationship between X and Y

    -   e.g. "I think that oil countries will have lower life expectancies than non-oil countries, irrespective of per capita GDP"

# Categorical Variables

## Categorical Variables

-   What do you do when you have more than two categories? (e.g. continents?)

-   You create distinct dummy variables for each category: Africa? 1 or 0; Asia? 1 or 0

-   You put the dummy variables in for all categories EXCEPT ONE

-   That category becomes the reference: the coefficients for all other dummies compare those levels of the category to the reference

-   R will do all this for you automatically if you include a categorical variable in the model

## Implementing a categorical variable

```{r}
gap.model.cont <- lm(lifeExp~log10(gdpPercap) + continent, data = gapminder)
summary(gap.model.cont)
```

## How to pick a reference

-   mathematically, it does not matter

-   BUT, it will impact what shows up as statistically significant in your output

-   e.g. if Europe had been the reference, we would see no stars next to Oceania

-   you can "relevel" you categorical variable to make the reference whatever makes the most intuitive sense

## Re-leveling

```{r}
gapminder$continent2 <- factor(gapminder$continent, levels = c("Europe", "Africa", "Americas", "Asia", "Oceania"))
gap.model.cont2 <- lm(lifeExp~log10(gdpPercap) + continent2, data = gapminder)
summary(gap.model.cont2)
```

# Binary DVs

## GDP and Olympics

-   are wealthier countries more likely to be selected to host the Olympics?

```{r}
olympics <- c("United States", "Italy", "France", "Norway", "Japan", "United Kingdom", "Greece", "Australia", "China", "South Korea", "Russia", "Austria", "Switzerland")
gapminder$olympics <- ifelse(gapminder$country %in% olympics, 1, 0)
```

## Look at your data!

```{r echo=FALSE}
ggplot(gapminder, aes(x = gdpPercap, y = olympics))+
    geom_point() +
  scale_x_log10() +
  theme_bw()
```

## Linear Probability Model (OLS)

```{r}
olymp.ols <- lm(olympics~log10(gdpPercap), data = gapminder)
summary(olymp.ols)
```

## Visualizing the LPM

```{r echo=FALSE}
ggplot(gapminder, aes(x = gdpPercap, y = olympics))+
    geom_point() +
  geom_abline(slope = .16, intercept = -.49, color = "blue") +
  scale_x_log10() +
  theme_bw()

```

## Logit Models

-   changes the functional form so that it's not linear

-   creates an "S" shape where $\hat Y_i$ cannot exceed 0 or 1

    ![](https://theeffectbook.net/the-effect_files/figure-html/statisticaladjustment-olslogit-1.png){width="700"}

## Logits in R

```{r}
olymp.logit <- glm(olympics~log10(gdpPercap), family = binomial(link = "logit"), data = gapminder)
summary(olymp.logit)
```

## How to interpret the logit coefficient

-   it's really hard! still positive vs. negative and stars

-   calculate the marginal effect by entering values into the logit equation

-   but the slope of the line changes with X!

-   marginal effect at mean: calculate the slope at the mean of X

-   average marginal effect: calculate the average slope across the entire curve

## Calculating average marginal effect

```{r}
#install.packages(modelsummary)
#install.packages(marginaleffects)
library(modelsummary)
library(marginaleffects)
avg_slopes(olymp.logit, variables = "gdpPercap")
```

## Visually

```{r echo=FALSE}
ggplot(gapminder, aes(x = gdpPercap, y = olympics))+
    geom_point() +
  geom_smooth(method = "lm", se = F) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), se = F, color = "red") +
  scale_x_log10() +
  theme_bw()


```
